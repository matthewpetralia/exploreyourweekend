{%- assign image_path = slug | append: ".webp" -%}
{%- assign aspect_ratio_parts = aspect_ratio | split: ":" -%}
{%- assign width_ratio = aspect_ratio_parts[0] | plus: 0 -%}
{%- assign height_ratio = aspect_ratio_parts[1] | plus: 0 -%}

{%- assign widths = "362, 480, 592, 640, 768, 800" | split: ", " -%}
{%- assign srcset_parts = "" -%}
{%- for width in widths -%}
  {%- assign height = width | times: height_ratio | divided_by: width_ratio | round -%}
  {%- assign current_url = "https://cdn.exploreyourweekend.com/cdn-cgi/image/quality=70,fit=cover,gravity=auto,width=" | append: width | append: ",height=" | append: height | append: ",format=auto/" | append: image_path -%}
  {%- assign srcset_part = current_url | append: " " | append: width | append: "w" -%}
  {%- unless forloop.last == true -%}
    {%- assign srcset_part = srcset_part | append: ", " -%}
  {%- endunless -%}
  {%- assign srcset_parts = srcset_parts | append: srcset_part -%}
{%- endfor -%}

{%- assign default_height = default_width | times: height_ratio | divided_by: width_ratio | round -%}
{%- assign default_src = "https://cdn.exploreyourweekend.com/cdn-cgi/image/quality=70,fit=cover,gravity=auto,width=" | append: default_width | append: ",height=" | append: default_height | append: ",format=auto/" | append: image_path -%}

<div class="image-wrapper" style="aspect-ratio: {{ width_ratio }} / {{ height_ratio }};">
  <img
    src="{{ default_src }}"
    srcset="{{ srcset_parts }}"
    sizes="{{ sizes }}"
    width="{{ default_width }}"
    height="{{ default_height }}"
    alt="{{ altTag }}"
    itemprop="image"
    decoding="async"
    {%- if fetchpriority == true -%}
    fetchpriority="high"
    {%- else -%}
    loading="lazy"
    {%- endif -%}>
</div>